<div class="container mt-4">
    <h2>{{ isEdit ? 'Editar' : 'Novo' }} Projeto</h2>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-control" formControlName="descricao"
                        [class.is-invalid]="form.get('descricao')?.invalid && form.get('descricao')?.touched">
                    <div class="invalid-feedback">
                        <div *ngIf="form.get('descricao')?.errors?.['required']">Descrição é obrigatória</div>
                        <div *ngIf="form.get('descricao')?.errors?.['minlength']">Mínimo 5 caracteres</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="mb-3">
                    <label class="form-label">Início</label>
                    <input type="date" class="form-control" formControlName="dataInicio">
                </div>
            </div>
            <div class="col-md-3">
                <div class="mb-3">
                    <label class="form-label">Fim</label>
                    <input type="date" class="form-control" formControlName="dataFim"
                        [class.is-invalid]="form.errors?.['invalidDate']">
                    <div class="invalid-feedback" *ngIf="form.errors?.['invalidDate']">
                        Data final deve ser após a inicial
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Equipe</label>
            <div class="row">
                <div class="col-md-6" *ngFor="let f of funcionarios">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" [value]="f.id"
                            [checked]="form.value.funcionarioIds.includes(f.id)"
                            (change)="toggleFuncionario(f.id!, $event)">
                        <label class="form-check-label">
                            {{ f.nome }} ({{ f.setor?.nome || 'Sem setor' }})
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex gap-2">
            <button type="button" class="btn btn-secondary" [routerLink]="['/projetos']">
                Cancelar
            </button>
            <button type="submit" class="btn btn-success" [disabled]="loading || form.invalid">
                <span *ngIf="loading" class="spinner-border spinner-border-sm"></span>
                {{ isEdit ? 'Atualizar' : 'Criar' }}
            </button>
        </div>
    </form>
</div>